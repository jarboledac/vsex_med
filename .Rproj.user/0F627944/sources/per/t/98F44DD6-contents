library(dplyr)
library(readxl)
library(janitor)
library(sf)
library(tidyverse)
library(ggplot2)
library(ggspatial)
library(dplyr)


# En la librería janitor tenemos la función clean_names(), la cual nos permite realizar la limpieza
# de los atributos de las bases de datos

source("/Users/jeferson/Documents/sisc/gestion_conocimiento/crime_mapping/functions.R")

data <- read_excel("/Users/jeferson/Documents/sisc/gestion_conocimiento/crime_mapping/Archivo plano homicidio Medellín 202111221100.xlsx")


coord_hom <- separate_lon_lat(data, "punto_hecho")

homi_sf <- st_as_sf(coord_hom,coords = c('longitud', 'latitud') ,crs = 4326)

#Gráfico
ggplot()+
  annotation_map_tile()+
  geom_sf(data = homi_sf)


shp_name <- file.choose()
medellin_lsoa <- st_read(shp_name) # Se leyeron las formas de las comunas.
View(medellin_lsoa)


#Gráfico de shapes

ggplot()+
  geom_sf(data = medellin_lsoa)



new_object <- select(data, codigo_comuna_hecho )
new_object <- na.omit(new_object)

count_crimes <- new_object %>%
  group_by(codigo_comuna_hecho) %>%
  summarise(count = n())

med_lsoa <- left_join(medellin_lsoa, count_crimes, by = c("COMUNA"="codigo_comuna_hecho"))


ggplot()+
  annotation_map_tile()+
  geom_sf(data = med_lsoa, aes(fill = count), alpha = 0.9)+
  scale_fill_gradient2(name ="Número de homicidios")



